<h2>Task overview: </h2>
<p>Task ID: {{ task.id }}</p>
<p>Number of scanpaths in this task: {{ task.scanpaths.length }}</p>
<hr />

<!-- Input calculation parameters -->
<h3>Common scanpath</h3>
<p>
    In order to reengineer web pages based on eyetracking, we first need to aggregate, analyse and understand how
    a group of peopleâ€™s eyetracking data can be combined to create a common scanpath (namely, eye movement sequence)
    in terms of visual elements.
</p>

<form class="form-vertical">
    <div class="form-group">
        <label for="selectAlgorithm">Algorithm for common scanpath comptutation:</label>
        <select id="selectAlgorithm" class="form-control" ng-model="modSelectAlgorithm" ng-disabled="customScanpath">
            <option value="">Choose an algorithm..</option>
            <optgroup label="Custom algorithms">
                <option>Scanpath trend analysis</option>
            </optgroup>
            <optgroup label="String-edit algorithms">
                <option>Longest common subsequence</option>
                <option>Shortest common supersequence</option>
            </optgroup>
        </select>
    </div>

    <div class="checkbox">
        <label>
            <input type="checkbox" ng-model="customScanpath">
            I want to provide my own common scanpath
        </label>
    </div>

    <div class="form-group" ng-show="customScanpath">
        <label for="customScanpathText">Enter the expected common scanpath</label>
        <div>
            <input class="form-control" type="text" ng-model="customScanpathText"
                   maxlength="40" placeholder="A B C D..">
        </div>
    </div>

    <button type="submit" class="btn btn-primary" ng-click="fillTableDetails()">Submit</button>
</form>
<hr />

<!-- Dataset overview -->
<div class="row">
    <div class="col-md-6">
        <h3>Results overview</h3>
        <!-- Calculated common scanpath -->
        <div class="row" ng-show="!customScanpath">
            <div class="col-md-12">
                <h4>Common scanpath:</h4>
                <p>
                    <span ng-hide="task.commonScanpath">Not available</span>
                    <span ng-repeat="fixation in task.commonScanpath.fixations track by $index">
                        {{ fixation[0] }} <sup>{{ fixation[1] }}</sup>
                    </span>
                </p>

                <h4>Average similarity to the common scanpath:</h4>
                <p>
                    <span ng-show="task.commonScanpath.avgSimToCommon">
                        {{ task.commonScanpath.avgSimToCommon | number: 2 }}%
                    </span>
                    <span ng-hide="task.commonScanpath.avgSimToCommon">N/A</span>
                </p>

                <h3>Display controls:</h3>
            </div>
        </div>
        <!-- Custom common scanpath -->
        <div class="row" ng-show="customScanpath">
            <div class="col-md-12">
                <h3>Custom scanpath:</h3>
                <p>
                    <span ng-hide="task.customScanpath">Not available</span>
                    <span ng-repeat="fixation in task.customScanpath.fixations track by $index">
                        {{ fixation[0] }}
                    </span>
                </p>

                <h4>Average similarity to the custom scanpath:</h4>
                <p>
                    <span ng-show="task.customScanpath.avgSimToCommon">
                        {{ task.customScanpath.avgSimToCommon | number: 2 }}%
                    </span>
                    <span ng-hide="task.customScanpath.avgSimToCommon">N/A</span>
                </p>
            </div>
        </div>
    </div>
    <!-- Dataset visuals -->
    <div id="canvasWrapper" class="col-md-6 text-center">
            <!-- TODO transparency used just for easy animation but animating ng-show is also possible -->
            <canvas id="scanpathCanvas" ng-class="{'transparent': !task.visuals.main}"
                    ng-click="toggleCanvasModal()"></canvas>
    </div>
    <!-- The modal background - clicking toggles the canvas modal again -->
    <div class="modal" ng-click="toggleCanvasModal()" ng-show="showCanvasModal">
        <!-- Modal content - force to do nothing on ng-click (else it gets toggled 2 times resulting in nothing) -->
        <div class="modal-content row" ng-click="$event.stopPropagation()">
            <!-- <span class="close" ng-click="toggleCanvasModal()">&times;</span> -->
            <div id="canvasWrapperModal" class="col-md-12 text-center">
                <div class="text-right">
                    <span class="modal-close" ng-click="toggleCanvasModal()">&times;</span>
                </div>
                <canvas id="scanpathCanvasModal"></canvas>
            </div>
        </div>
    </div>
</div>
<hr />

<div class="row">
    <div id="scanpathTableWrapper">
        <!-- Results overview -->
        <table class="table table-hover table-responsive" id="scanpathTable">
            <thead>
                <tr>
                    <th ng-click="setSort('identifier')">ID</th>
                    <th>Eye fixations (ms)</th>
                    <th ng-click="setSort('fixations.length')">Scanpath length</th>
                    <th ng-click="setSort('maxSimilarity.identifier')">Most similar to</th>
                    <th ng-click="setSort('maxSimilarity.value')">Most similar to (val)</th>
                    <th ng-click="setSort('minSimilarity.identifier')">Least similar to</th>
                    <th ng-click="setSort('minSimilarity.value')">Least similar to (val)</th>
                    <th ng-click="setSort('simToCommon')">Similarity to common</th>
                </tr>
            </thead>
            <tr ng-repeat="scanpath in task.scanpaths | orderBy: [task.sortBy, 'identifier'] | UndefToEnd: task.sortBy"
                ng-class="{'row-excluded': scanpath.excluded}">
                <td>{{ scanpath.identifier }} <br />
                    <span class="glyphicon glyphicon-ok control-include"
                          ng-click="toggleScanpathExcluded(scanpath)" ng-class="{'hidden': scanpath.excluded}"></span>
                    <span class="glyphicon glyphicon-remove control-exclude"
                          ng-click="toggleScanpathExcluded(scanpath)" ng-class="{'hidden': !scanpath.excluded}"></span>
                </td>
                <td class="colFixations col-md-4">
                    <span ng-repeat="fixation in scanpath.fixations track by $index">
                        {{ fixation[0]}} <sup>{{ fixation[1] }}</sup>
                    </span>
                    <a href="" class="pull-right"><span class="glyphicon glyphicon-menu-down"></span></a>
                </td>
                <td>{{ scanpath.fixations.length }}</td>
                <td>{{ scanpath.maxSimilarity.identifier }}</td>
                <td>{{ scanpath.maxSimilarity.value | number: 2}}%</td>
                <td>{{ scanpath.minSimilarity.identifier }}</td>
                <td>{{ scanpath.minSimilarity.value | number: 2}}%</td>
                <td ng-show="scanpath.simToCommon >= 0">
                    {{ scanpath.simToCommon | number: 2 }}%
                </td>
                <td ng-hide="scanpath.simToCommon >= 0">N/A</td>
            </tr>
        </table>
    </div>
    <button class="btn btn-default btn-sm" id="enableAllButton" ng-click="setAllScanpathsValue(false)">Enable all</button>
    <button class="btn btn-default btn-sm" id="disableAllButton" ng-click="setAllScanpathsValue(true)">Disable all</button>
</div>